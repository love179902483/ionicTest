$(function(){fn_navTabChange(),fn_infoData(),fn_courseListDataAjax(),fn_hotList(),fn_newList(),fn_wxShare(basicParameterArry)});var iOSSectionId=null,isPlay=!1;window.onload=function(){shareDesc=$(".courseIntroduction").text(),fn_qqShare(),$(".videoPlayBox").unbind("click").bind("click",function(){$('.chaptersList[thiscourseprice="0"]').eq(0).click().addClass("chaptersListNameActive"),$(this).hide()}),openApp()};var shareImg,shareTitle,shareDesc,shareLink,time=Date.parse(new Date)/1e3,date=(new Date).pattern("yyyy-MM-dd hh:mm:ss"),hostPic="http://static2.ichunqiu.com/icq/",app_key="app_key=100003&",app_from="from=100000003&",timestamp="timestamp="+time+"&",dateTime="datetime="+date+"&",ver="ver=1&",counter=0,k=0,page=-1,basicParameterArry=["app_key=100003","from=100000003","timestamp="+time,"datetime="+date,"ver=1","url="+location.href.split("#")[0],"method=open.js.config"];function fn_courseListDataAjax(){var t={app_key:100003,timestamp:Date.parse(new Date)/1e3,method:"open.course.list.get",from:"100000003",datetime:(new Date).pattern("yyyy-MM-dd hh:mm:ss"),ver:1,id:GetQueryString("id"),type:GetQueryString("type")};$.fn_ajax({url:host,options:t||{},success_callback:function(t){$("#videoPlay").attr("src",t.data.chapter_list[0].course_list[0].course_play_url),fn_foundElementByChapter(t)},error_callback:function(t,e){console.log("网络异常，请稍后重试")},loading:function(){}})}function fn_infoData(){var t={app_key:100003,timestamp:Date.parse(new Date)/1e3,method:"open.course.info.get",from:"100000003",datetime:(new Date).pattern("yyyy-MM-dd hh:mm:ss"),ver:1,id:GetQueryString("id"),type:GetQueryString("type")};$.fn_ajax({url:host,options:t||{},success_callback:function(t){$("title").text(t.data.course_intro.course_name),$("meta[name=keywords]").attr("content",t.data.course_intro.course_name),$("meta[name=description]").attr("content",t.data.course_intro.description),$(".moreInstructor").unbind("click").bind("click",function(){}),t.data.teacher_list.length<=4&&($(".moreInstructor").hide(),$(".moreIcon").hide()),$("#videoPlay").attr("poster",t.data.course_intro.img_url),shareImg=t.data.course_intro.img_url,shareTitle="我在i春秋学习《"+t.data.course_intro.course_name+"》",fn_foundElementByInstructorTeam(t.data.teacher_list),fn_foundElementByCourseIntroduction(t.data.course_intro)},error_callback:function(t,e){console.log("网络异常，请稍后重试")},loading:function(){}})}function fn_hotList(){var t={app_key:100003,timestamp:Date.parse(new Date)/1e3,method:"open.course.comment.get",from:"100000003",datetime:(new Date).pattern("yyyy-MM-dd hh:mm:ss"),ver:1,id:GetQueryString("id"),type:GetQueryString("type"),page_index:0,page_size:3,comment_type:2};$.fn_ajax({url:host,options:t||{},success_callback:function(t){t.data.hot_list.length<=0&&$(".hostcommendMain").hide(),fn_findHostCommend(t)},error_callback:function(t,e){console.log("网络异常，请稍后重试")},loading:function(){}})}function fn_newList(){var t={app_key:100003,timestamp:Date.parse(new Date)/1e3,method:"open.course.comment.get",from:"100000003",datetime:(new Date).pattern("yyyy-MM-dd hh:mm:ss"),ver:1,id:GetQueryString("id"),type:GetQueryString("type"),page_index:0,page_size:3,comment_type:1};$.fn_ajax({url:host,options:t||{},success_callback:function(t){t.data.comment_list.length<=0&&$(".commentTitleMain").hide();var e=parseInt($(".hostMain").find(".userCommentHotMain").length)+parseInt(t.data.total);e>10?$(".commentNum").css("right","20px"):e>100?$(".commentNum").css("right","14px"):320==$(window).width()&&e>100?$(".commentNum").css("right","4px"):320==$(window).width()&&e>10&&$(".commentNum").css("right","14px"),$(".commentNum").append("("+e+")"),fn_findNewCommendList(t)},error_callback:function(t,e){console.log("网络异常，请稍后重试")},loading:function(){}})}function fn_droploadNewCommentAjax(t,e,a){var i={app_key:100003,timestamp:Date.parse(new Date)/1e3,method:"open.course.reply.get",from:"100000003",datetime:(new Date).pattern("yyyy-MM-dd hh:mm:ss"),ver:1,comment_id:t,page_index:a,page_size:5,comment_type:t};$.fn_ajax({url:host,options:i||{},success_callback:function(t){t.data.list},error_callback:function(t,e){console.log("网络异常，请稍后重试")},loading:function(){}})}function gettime(t){var e=Date.parse(new Date)/1e3-new Date(Date.parse(t.replace(/-/g,"/"))/1e3);return e<60?"刚刚":e>=60&&e<3600?Math.floor(e/60)+"分钟前":e>=3600&&e<86400?Math.floor(e/3600)+"小时前":e>=86400&&e<2592e3?Math.floor(e/86400)+"天前":e>=2592e3&&e<31104e3?Math.floor(e/2592e3)+"个月前":"很久前"}function fn_videoPlay(t,e){var a=videojs("videoPlay",{techOrder:["html5"]},function(){this.on("ended",function(){this.pause()})});$("#videoPlay_html5_api").attr("src",e),1==t&&a.play(),a.on("pause",function(){$(".videoControls").show(),$("#videoPlay").attr("controls","true")})}function fn_navTabChange(){$(".navList").unbind().bind("click",function(){var t=$(this).index();$(this).removeClass("navActive").addClass("navActive").siblings().removeClass("navActive"),$(".changeBox").eq(t).removeClass("wapActive").addClass("wapActive").siblings().removeClass("wapActive")})}function fn_foundElementByChapter(t){for(var e=0;e<t.data.chapter_list.length;e++){var a=$('<div class="chapter overFlow"></div>'),i=$('<div class="chapterTitle"></div>'),n=$('<span class="titleText fl">'+t.data.chapter_list[e].chapter_title+"</span>"),s=$('<i class="icon courseIcon rotate"><img src="img/tab2_icon_down.png" /></i>'),o=$('<span class="courseListShowBtn">展开<span class="courseNum">('+t.data.chapter_list[e].course_list.length+")</span></span>"),c=$('<span class="courseListHideBtn">收起<span class="courseNum">('+t.data.chapter_list[e].course_list.length+")</span></span>");i.append(n),i.append(s),i.append(o),i.append(c),i.unbind("click").bind("click",function(){$(this).find(".courseListShowBtn").toggleClass("courseListShowBtnActive"),$(this).find(".courseListHideBtn").toggleClass("courseListHideBtnActive"),$(this).find(".courseIcon").toggleClass("rotate"),$(this).siblings(".chapters").toggle()}),a.append(i);for(var r,d,l,p=$('<ul class="chapters"></ul>'),m=0;m<t.data.chapter_list[e].course_list.length;m++){var u=$('<li class="chaptersList clearfix" thisVideo='+t.data.chapter_list[e].course_list[m].course_play_url+" thisCoursePrice="+t.data.chapter_list[e].course_list[m].course_price+" chapterId="+t.data.chapter_list[e].chapter_id+" sectionId="+t.data.chapter_list[e].course_list[m].section_id+" ></li>");u.unbind("click").bind("click",function(){$("#videoPlay").attr("src",""),$("#videoPlay").find("source").attr("src",""),$(this).find(".chaptersListName").removeClass("chaptersListNameActive").addClass("chaptersListNameActive"),$(this).siblings().find(".chaptersListName").removeClass("chaptersListNameActive"),$(this).parents(".chapter").siblings().find(".chaptersListName").removeClass("chaptersListNameActive");$(this).parents(".chapter").index(),$(this).index();if(iOSSectionId=$(this).attr("sectionId"),$(this).attr("thisCoursePrice")>0)$(".downloadBtn").click();else if(0==$(this).attr("thisCoursePrice")){isPlay=!0;var t=$(this).attr("thisVideo");$("#videoPlay").attr("src",t),$("#videoPlay").find("source").attr("src",t),fn_videoPlay(isPlay,t)}});var h=$('<div class="listBox"></div>'),_=$('<i class="icon chapterListNum fl">'+(m+1)+"</i>"),v=$('<div class="chaptersListNameBox fl"></div>'),f=$('<div class="chaptersListName">'+t.data.chapter_list[e].course_list[m].course_title+"</div>"),g=$('<div class="chaptersTime">'+t.data.chapter_list[e].course_list[m].course_time+"分钟</div>"),y=$('<i class="chaptersPicIcon icon"></i>'),k=$('<img src="img/career_icon_shiyan.png" />');l=0==t.data.chapter_list[e].course_list[m].course_price?"免费":t.data.chapter_list[e].course_list[m].course_price+"泉";var w=$('<span class="chaptersCost fl">'+l+"</span>");w.unbind("click").bind("click",function(){"免费"!=$(this).text()&&$(".downloadBtn").click()});var x=$('<div class="stateBox fl"></div>'),b=$('<div class="statePic"></div>');0==t.data.chapter_list[e].course_list[m].learn_status?(r="career_icon_Did-not-learn.png",d="未学习"):1==t.data.chapter_list[e].course_list[m].learn_status?(r="career_icon_In-the-study.png",d="学习中"):(r="career_icon_Have-learned.png",d="已完成");var C=$('<img src="img/'+r+'" class="stadyPic" />'),L=$('<div class="stateText">'+d+"</div>");if(y.append(k),v.append(f),v.append(g),1==t.data.chapter_list[e].course_list[m].is_exp&&v.append(y),b.append(C),x.append(b),x.append(L),h.append(_),h.append(v),h.append(w),h.append(x),m<t.data.chapter_list[e].course_list.length-1){var I=$('<i class="icon iconLong"></i>');h.append(I)}u.append(h),p.append(u),a.append(p)}$(".chapterWap").append(a)}$('.chaptersList[thiscourseprice="0"] .chaptersListNameBox').eq(0).find("div").removeClass("chaptersListNameActive").addClass("chaptersListNameActive")}function fn_foundElementByInstructorTeam(t){for(var e=0;e<t.length;e++){var a=$('<dl class="teacherList"></dl>'),i=$('<dt><img src="'+t[e].img_url+'" /></dt>'),n=$("<dd>"+t[e].name+"</dd>");if(a.append(i),a.append(n),a.unbind("click").bind("click",function(){$(".downloadBtn").click()}),e>=4)break;$(".teacherHeaderPicWap").append(a)}}function fn_foundElementByCourseIntroduction(t){var e=$('<div class="courseIntroductionTop"></div>'),a=$('<div class="teacherPic fl"></div>'),i=$('<img src="'+t.img_url+'" />'),n=$('<p class="lecturerTitle">'+t.course_name+"</p>"),s=$('<p class="courseDetails"><span class="courseNumber">'+t.course_num+'节课程</span><span class="courseTotalLength">'+t.course_time+'小时</span><span class="studyNumber">'+t.course_people+"人已学</span></p>");a.append(i),e.append(a),e.append(n),e.append(s);var o=$('<div class="courseIntroduction">'+t.description+"</div>");$(".courseIntroductionWap").append(e),$(".courseIntroductionWap").append(o)}function fn_findHostCommend(t){$(".hostMain").children().remove();for(var e=0;e<t.data.hot_list.length;e++){k++;var a=$('<div class="userCommentHotMain" thisindex='+k+"></div>"),i=$('<div class="userCommentHotInformation"><div class="commentUserPic"><img src='+t.data.hot_list[e].img_url+' alt="用户头像" /></div><span class="userCommentName">'+t.data.hot_list[e].username+'</span><span class="userCommentTime">'+gettime(t.data.hot_list[e].time)+"</span></div>"),n=$('<div class="userCommentHotTextMain tsxtEllipsis" user_id='+t.data.hot_list[e].user_id+" commend_id="+t.data.hot_list[e].comment_id+">"+t.data.hot_list[e].content+"</div>");n.bind("click",function(t){$(".downloadBtn").click()});var s=$('<div class="userInteractionWrap overFlow"></div>');$('<div class="overFlow"></div>');if(a.append(i),a.append(n),a.append(s),0!=t.data.hot_list[e].reply_num){var o=$('<div class="interactionBox" commend_id='+t.data.hot_list[e].comment_id+" totalNum="+t.data.hot_list[e].reply_num+'><div class="interactionText fl"><span class="box">展开查看'+t.data.hot_list[e].reply_num+'条互动<i class="icon interactionIcon"><img src="img/icon_down.png" /></i></span></div></div>');o.unbind("click").bind("click",function(t){$(".downloadBtn").click()}),a.append(o)}$(".hostMain").append(a)}}function fn_findNewCommendList(t){for(var e=0;e<t.data.comment_list.length;e++){k++;var a=$('<div class="userCommentHotMain" thisindex='+k+"></div>"),i=$('<div class="userCommentHotInformation"><div class="commentUserPic"><img src='+t.data.comment_list[e].img_url+' alt="用户头像" /></div><span class="userCommentName">'+t.data.comment_list[e].username+'</span><span class="userCommentTime">'+gettime(t.data.comment_list[e].time)+"</span></div>"),n=$('<div class="userCommentHotTextMain tsxtEllipsis" user_id='+t.data.comment_list[e].user_id+" commend_id="+t.data.comment_list[e].comment_id+">"+t.data.comment_list[e].content+"</div>"),s=$('<div class="userInteractionWrap overFlow"></div>');$('<div class="overFlow"></div>');if(n.bind("click",function(t){$(".downloadBtn").click()}),a.append(i),a.append(n),a.append(s),0!=t.data.comment_list[e].reply_num){var o=$('<div class="interactionBox" commend_id='+t.data.comment_list[e].comment_id+" totalNum="+t.data.comment_list[e].reply_num+'><div class="interactionText fl"><span class="box">展开查看'+t.data.comment_list[e].reply_num+'条互动<i class="icon interactionIcon"><img src="img/icon_down.png" /></i></span></div></div>');o.unbind("click").bind("click",function(t){$(".downloadBtn").click()}),a.append(o)}$(".newsCommentBox").append(a)}}function fn_droploadNewComment(t,e,a){var i=$('<i class="icon interactionIcon"><img src="img/icon_down.png" /></i>');"收起"!=$(t).find(".box").text()?a/5<=0?(i.addClass("rotate"),$(t).find(".box").text("收起").append(i),$(t).prev().show(300),fn_droploadNewCommentAjax(e,t,page)):(page++,$(t).find(".box").text("展开查看"+(a-5*(page+1))+"条互动").append(i),fn_droploadNewCommentAjax(e,t,page),a-5*(page+1)<=0&&(i.addClass("rotate"),$(t).find(".box").text("收起").append(i),$(t).prev().show(300),page=-1)):(i.removeClass("rotate"),$(t).find(".box").text("展开查看"+a+"条互动").append(i),$(t).siblings(".userInteractionWrap").children().remove())}function fn_qqShare(){setShareInfo({title:shareTitle,summary:shareDesc,pic:shareImg,url:shareLink})}shareLink=location.href.split("#")[0];var openApp=function(){var t=GetQueryString("id"),e=$('.chaptersList[thiscourseprice="0"]').eq(0).attr("sectionid")||$(".chaptersList").eq(0).attr("sectionid"),a=GetQueryString("type"),i=returnMlinkUrl(),n=$(".downloadBtn");GetQueryString("coterie_id");new Mlink([{mlink:i+'{"cmd": "video", "data":"{\\"type\\" : '+a+',\\"courseId\\": '+t+', \\"sectionId\\": '+e+'}", "goUpdate": true, "maxsdk": -1, "minisdk": 1003003000,"msg": "您当前版本过低，请更新"}',button:n}])};
function fn_wxShare(e){var n=e.sort().join("&"),i=$.md5(n+"&612e9a2ebe762486d04eb29411344769");$.post(wxhost,{app_key:"100003",from:"100000003",timestamp:time,datetime:date,ver:1,method:"open.js.config",url:location.href.split("#")[0],sig:i},function(e,n,i){e=JSON.parse(e);wx.config({debug:!1,appId:e.data.app_id,timestamp:e.data.timestamp,nonceStr:e.data.nonce_str,signature:e.data.signature,jsApiList:["onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareQZone","hideMenuItems"]}),wx.ready(function(){wx.showOptionMenu(),wx.onMenuShareTimeline({title:shareTitle,link:shareLink,desc:shareDesc,imgUrl:shareImg,trigger:function(){},success:function(){},cancel:function(){}}),wx.onMenuShareAppMessage({title:shareTitle,link:shareLink,desc:shareDesc,imgUrl:shareImg,trigger:function(){},success:function(){},cancel:function(){}}),wx.onMenuShareQQ({title:shareTitle,link:shareLink,desc:shareDesc,imgUrl:shareImg,trigger:function(){},success:function(){},cancel:function(){}}),wx.onMenuShareQZone({title:shareTitle,link:shareLink,desc:shareDesc,imgUrl:shareImg,trigger:function(){},success:function(){},cancel:function(){}})}),wx.error(function(e){console.log(e.errMsg)})})}